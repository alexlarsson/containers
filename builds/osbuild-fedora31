FROM docker.io/library/fedora:31

# Configure dnf
RUN echo "fastestmirror=1" >> /etc/dnf/dnf.conf && \
      echo "install_weak_deps=0" >> /etc/dnf/dnf.conf && \
      rm -fv /etc/yum.repos.d/fedora*modular*

# Install requirements for building RPMs.
RUN dnf -y upgrade && \
      dnf -y install dnf-plugins-core findutils git make python3-docutils \
        python3-devel python3-rpm-generators python-rpm-macros \
        python3-rpm-macros rpm-build rpmdevtools && \
      dnf clean all

# Install requirements for building osbuild and osbuild-composer.
RUN curl -O https://raw.githubusercontent.com/osbuild/osbuild-composer/master/osbuild-composer.spec && \
      curl -O https://raw.githubusercontent.com/osbuild/osbuild/master/osbuild.spec && \
      dnf -y builddep osbuild-composer.spec osbuild.spec && \
      dnf clean all && \
      rm -f *.spec

# Make Ansible happy with arbitrary UID/GID in OpenShift.
RUN chmod g=u /etc/passwd /etc/group
